        {activeTab === 'calculator' && (
          <div className="max-w-6xl mx-auto space-y-6 animate-in fade-in duration-500">
            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div className="flex flex-col gap-1">
                <h2 className="text-3xl font-extrabold text-[#0f172a]">Calculadora</h2>
                <p className="text-slate-500 text-sm font-medium">Os valores calculados aqui serão os usados no Dashboard ao salvar.</p>
              </div>
              <div className="flex items-center gap-3">
                <button
                  onClick={handleSaveDefaults}
                  className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition-all"
                >
                  <Save className="w-4 h-4" />
                  Salvar Padrão
                </button>
                <button
                  onClick={handleResetDefaults}
                  className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold text-rose-500 hover:bg-rose-50 transition-all border-rose-100"
                >
                  <RefreshCw className="w-4 h-4" />
                  Resetar
                </button>
                <button onClick={handleGenerateSummary} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition-all">
                  <FileText className="w-4 h-4" />
                  Gerar Resumo
                </button>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
              <div className="lg:col-span-7 space-y-4">
                <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                  <button onClick={() => toggleSection('piece')} className="w-full flex items-center justify-between p-6 hover:bg-slate-50 transition-colors">
                    <div className="flex items-center gap-3"><Clock className="w-5 h-5 text-sky-500" /><span className="font-bold text-slate-800">Detalhes da Peça</span></div>
                    {expandedSections.piece ? <ChevronUp className="w-5 h-5 text-slate-400" /> : <ChevronDown className="w-5 h-5 text-slate-400" />}
                  </button>
                  {expandedSections.piece && (
                    <div className="px-6 pb-8 grid grid-cols-2 gap-6 animate-in slide-in-from-top-2 duration-200">
                      <div><label className="block text-sm font-medium text-slate-500 mb-2">Tempo de impressão (horas)</label>
                        <input type="number" value={calcInputs.printingTime} onChange={(e) => setCalcInputs({ ...calcInputs, printingTime: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl px-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.printingTime === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} />
                      </div>
                      <div><label className="block text-sm font-medium text-slate-500 mb-2">Peso da peça (gramas)</label>
                        <input type="number" value={calcInputs.partWeight} onChange={(e) => setCalcInputs({ ...calcInputs, partWeight: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl px-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.partWeight === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} />
                      </div>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                  <button onClick={() => toggleSection('material')} className="w-full flex items-center justify-between p-6 hover:bg-slate-50 transition-colors">
                    <div className="flex items-center gap-3"><Zap className="w-5 h-5 text-amber-500" /><span className="font-bold text-slate-800">Material e Energia</span></div>
                    {expandedSections.material ? <ChevronUp className="w-5 h-5 text-slate-400" /> : <ChevronDown className="w-5 h-5 text-slate-400" />}
                  </button>
                  {expandedSections.material && (
                    <div className="px-6 pb-8 space-y-6 animate-in slide-in-from-top-2 duration-200">
                      <div className="grid grid-cols-2 gap-6">
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Custo do filamento PLA por kg</label>
                          <div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm">R$</span><input type="number" value={calcInputs.filamentCostPerKg} onChange={(e) => setCalcInputs({ ...calcInputs, filamentCostPerKg: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.filamentCostPerKg === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div>
                        </div>
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Consumo da impressora (kWh/h)</label><input type="number" step="0.01" value={calcInputs.printerConsumption} onChange={(e) => setCalcInputs({ ...calcInputs, printerConsumption: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl px-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.printerConsumption === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div>
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Custo do kWh</label><div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm">R$</span><input type="number" step="0.01" value={calcInputs.kWhCost} onChange={(e) => setCalcInputs({ ...calcInputs, kWhCost: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.kWhCost === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div></div>
                      </div>
                      <div>
                        <div className="flex items-center justify-between mb-2"><label className="flex items-center gap-2 text-xs font-bold text-slate-800"><Percent className="w-3 h-3" /> Perda de Filamento</label><span className="text-xs font-black text-sky-500">{calcInputs.filamentLossPercentage}%</span></div>
                        <input type="range" min="0" max="30" step="1" value={calcInputs.filamentLossPercentage} onChange={(e) => setCalcInputs({ ...calcInputs, filamentLossPercentage: parseInt(e.target.value) })} className="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-sky-500" />
                      </div>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                  <button onClick={() => toggleSection('labor')} className="w-full flex items-center justify-between p-6 hover:bg-slate-50 transition-colors">
                    <div className="flex items-center gap-3"><Briefcase className="w-5 h-5 text-indigo-500" /><span className="font-bold text-slate-800">Mão de Obra e Negócio</span></div>
                    {expandedSections.labor ? <ChevronUp className="w-5 h-5 text-slate-400" /> : <ChevronDown className="w-5 h-5 text-slate-400" />}
                  </button>
                  {expandedSections.labor && (
                    <div className="px-6 pb-8 space-y-6 animate-in slide-in-from-top-2 duration-200">
                      <div className="grid grid-cols-2 gap-6">
                        <div>
                          <label className="block text-sm font-medium text-slate-500 mb-2">Valor da sua hora de trabalho</label>
                          <div className="relative">
                            <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm">R$</span>
                            <input type="number" value={calcInputs.laborHourValue} onChange={(e) => setCalcInputs({ ...calcInputs, laborHourValue: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-200 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500/10 ` + (calcInputs.laborHourValue === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-500 mb-2">Horas de trabalho manual</label>
                          <div className="relative">
                            <Clock className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4" />
                            <input type="number" step="0.1" value={calcInputs.laborTimeSpent} onChange={(e) => setCalcInputs({ ...calcInputs, laborTimeSpent: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-200 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500/10 ` + (calcInputs.laborTimeSpent === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} />
                          </div>
                        </div>
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Custos fixos mensais</label><div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm">R$</span><input type="number" value={calcInputs.fixedMonthlyCosts} onChange={(e) => setCalcInputs({ ...calcInputs, fixedMonthlyCosts: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.fixedMonthlyCosts === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div></div>
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Horas produtivas no mês</label><input type="number" value={calcInputs.productiveHoursMonth} onChange={(e) => setCalcInputs({ ...calcInputs, productiveHoursMonth: parseFloat(e.target.value) || 1 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl px-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.productiveHoursMonth === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div>
                      </div>
                      <div>
                        <div className="flex items-center justify-between mb-2"><label className="flex items-center gap-2 text-xs font-bold text-slate-800"><Percent className="w-3 h-3" /> Margem de Lucro</label><span className="text-xs font-black text-sky-500">{calcInputs.profitMargin}%</span></div>
                        <input type="range" min="0" max="300" step="5" value={calcInputs.profitMargin} onChange={(e) => setCalcInputs({ ...calcInputs, profitMargin: parseInt(e.target.value) })} className="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-sky-500" />
                      </div>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                  <button onClick={() => toggleSection('machine')} className="w-full flex items-center justify-between p-6 hover:bg-slate-50 transition-colors">
                    <div className="flex items-center gap-3"><Wrench className="w-5 h-5 text-rose-500" /><span className="font-bold text-slate-800">Manutenção da Impressora</span></div>
                    {expandedSections.machine ? <ChevronUp className="w-5 h-5 text-slate-400" /> : <ChevronDown className="w-5 h-5 text-slate-400" />}
                  </button>
                  {expandedSections.machine && (
                    <div className="px-6 pb-8 space-y-6 animate-in slide-in-from-top-2 duration-200">
                      <div className="grid grid-cols-2 gap-4">
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Vida útil da máquina (horas)</label><div className="relative"><Zap className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4" /><input type="number" value={calcInputs.printerLifespan} onChange={(e) => setCalcInputs({ ...calcInputs, printerLifespan: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.printerLifespan === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div></div>
                        <div><label className="block text-sm font-medium text-slate-500 mb-2">Orçamento manutenção (R$)</label><div className="relative"><DollarSign className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4" /><input type="number" step="0.01" value={calcInputs.maintenanceBudget} onChange={(e) => setCalcInputs({ ...calcInputs, maintenanceBudget: parseFloat(e.target.value) || 0 })} className={`w-full bg-[#f8fafc] border border-slate-100 rounded-xl pl-10 pr-4 py-2.5 text-sm font-medium outline-none ` + (calcInputs.maintenanceBudget === 0 ? 'text-rose-600 font-bold' : 'text-slate-700')} /></div></div>
                      </div>
                      <div className="p-4 bg-slate-50 rounded-xl"><p className="text-xs font-bold text-slate-500 uppercase tracking-tight mb-1">Custo de Manutenção por Hora</p><p className="text-lg font-black text-rose-600">{formatCurrency(calcResults.hourlyMaintenanceRate)} / hora</p></div>
                    </div>
                  )}
                </div>
              </div>

              <div className="lg:col-span-12 xl:col-span-5 space-y-6">
                <div className="bg-white rounded-2xl border border-slate-100 shadow-sm p-8 space-y-8">
                  <h3 className="text-lg font-bold text-sky-500">Análise de Custos</h3>
                  <div className="space-y-5">
                    <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full bg-amber-500"></div><span className="text-sm font-medium text-slate-600">Custo do filamento</span></div><span className="text-sm font-bold text-slate-900">{formatCurrency(calcResults.materialCost)}</span></div>
                    <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full bg-yellow-400"></div><span className="text-sm font-medium text-slate-600">Custo de energia</span></div><span className="text-sm font-bold text-slate-900">{formatCurrency(calcResults.energyCost)}</span></div>
                    <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full bg-indigo-500"></div><span className="text-sm font-medium text-slate-600">Custo de mão de obra</span></div><span className="text-sm font-bold text-slate-900">{formatCurrency(calcResults.laborCost)}</span></div>
                    <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full bg-sky-400"></div><span className="text-sm font-medium text-slate-600">Custo fixo rateado</span></div><span className="text-sm font-bold text-slate-900">{formatCurrency(calcResults.fixedRateCost)}</span></div>
                    <div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full bg-slate-500"></div><span className="text-sm font-medium text-slate-600">Custo de manutenção</span></div><span className="text-sm font-bold text-slate-900">{formatCurrency(calcResults.maintenanceCost)}</span></div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl border-l-4 border-sky-500 shadow-sm p-8 space-y-6">
                  <div className="flex items-center justify-between"><span className="text-xs font-bold text-slate-400 uppercase tracking-widest">Custo Total da Peça</span><span className="text-xl font-bold text-slate-900">{formatCurrency(calcResults.subtotal)}</span></div>
                  <div className="flex items-center justify-between border-b border-slate-50 pb-6"><span className="text-xs font-medium text-slate-500">Margem de Lucro ({calcInputs.profitMargin}%)</span><span className="text-sm font-bold text-emerald-500">+ {formatCurrency(calcResults.profit)}</span></div>
                  <div className="bg-emerald-50 rounded-2xl p-6 flex items-center justify-between"><span className="text-sm font-bold text-emerald-600 uppercase tracking-tight">Preço Final</span><span className="text-3xl font-black text-emerald-700">{formatCurrency(calcResults.total)}</span></div>
                  <button onClick={() => {
                    setNewOrder({
                      ...EMPTY_ORDER,
                      unitValue: Number(calcResults.total.toFixed(2)),
                      unitCost: Number(calcResults.subtotal.toFixed(2)),
                      weight: calcInputs.partWeight,
                      time: calcInputs.printingTime,
                      powerConsumption: Number((calcInputs.printingTime * calcInputs.printerConsumption).toFixed(3)),
                      laborTime: calcInputs.laborTimeSpent
                    });
                    setActiveTab('orders');
                    setIsOrderModalOpen(true);
                  }} className="w-full py-4 bg-sky-500 text-white rounded-2xl font-bold hover:bg-sky-400 transition-all flex items-center justify-center gap-2 shadow-lg shadow-sky-100"><Plus className="w-5 h-5" />Adicionar aos Pedidos</button>
                </div>
              </div>
            </div>
          </div>
        )}
